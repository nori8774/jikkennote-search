# 要件定義: サフィックス名寄せ機能

## 背景

実験ノートのデータセットにおいて、同一の材料でも実験者によって異なるナンバリング規則が使用されている：

- **ID1系（実験者1）**: HbA1c捕捉抗体1, HbA1c捕捉抗体2, HbA1c捕捉抗体3
- **ID2系（実験者2）**: HbA1c捕捉抗体A, HbA1c捕捉抗体B, HbA1c捕捉抗体C

これらは同一の材料の異なるロット/バリエーションを指すが、現状の正規化辞書では「HbA1c捕捉抗体1」と「HbA1c捕捉抗体A」が同等であることを認識できない。

## 目的

正規化辞書に「サフィックス同等グループ」の概念を追加し、異なるナンバリング規則を持つ材料名を同一のものとして検索できるようにする。

## スコープ

### 対象

- 正規化辞書のデータ構造拡張
- 辞書管理モジュール（dictionary.py）の更新
- テキスト正規化ロジック（utils.py）の更新
- フロントエンド辞書管理UIの更新

### 対象外

- 検索ロジック自体の変更（正規化後のテキストを使用するため変更不要）
- 既存ノートの再取り込み（正規化は検索時に適用）

## 機能要件

### FR-1: 辞書構造の拡張

正規化辞書に `suffix_equivalents` フィールドを追加：

```yaml
- canonical: HbA1c捕捉抗体
  variants:
    - HbA1c捕捉抗体1
    - HbA1c捕捉抗体2
    - HbA1c捕捉抗体A
    - HbA1c捕捉抗体B
  category: 抗体
  suffix_equivalents:
    - ["1", "A"]
    - ["2", "B"]
    - ["3", "C"]
```

### FR-2: 2階層正規化

1. **第1階層（ベース名正規化）**: バリアントからcanonicalへの置換（既存）
2. **第2階層（サフィックス正規化）**: サフィックスの統一（新規）

例：
- `HbA1c捕捉抗体A` → `HbA1c捕捉抗体` + サフィックス`A` → サフィックス`A`は`1`と同等 → `HbA1c捕捉抗体1`

### FR-3: 辞書管理UI

- サフィックス同等グループの表示・編集機能
- グループの追加・削除

## 非機能要件

### NFR-1: 後方互換性

- `suffix_equivalents` が未定義のエントリは従来通り動作
- 既存の辞書ファイルは変更不要

### NFR-2: パフォーマンス

- サフィックス正規化による検索遅延は1%未満

## 成功基準

1. `HbA1c捕捉抗体1` と `HbA1c捕捉抗体A` が検索で同等に扱われる
2. 辞書UIでサフィックス同等グループを編集できる
3. 既存の辞書・検索機能に影響なし
