# 要件定義書: UI/UX機能改善（Phase 4）

## 概要

**機能名**: UI/UX機能改善
**作成日**: 2026-01-02
**関連要件**: FR-113（再検索機能）、FR-114（コピー機能強化）、FR-115（評価機能改善）

---

## 背景と目的

### 背景
- 現在の検索UIでは、検索結果を見た後に条件を微調整して再検索するワークフローが煩雑
- ノートビューワーや検索結果から検索条件を引用する機能が不足
- 評価機能のCSV出力やデバッグ表示に改善余地がある

### 目的
1. 再検索ワークフローを簡素化し、ユーザーの試行錯誤を支援
2. ノート内容から検索条件を素早く設定できるコピー機能を提供
3. 評価機能の出力形式を改善し、分析しやすくする

---

## 機能要件

### FR-113: 再検索機能

#### FR-113.1: 重点指示追加による再検索
- **Must**: 検索結果画面に「重点指示を追加して再検索」ボタン表示
- **Must**: モーダルで重点指示を入力可能
- **Must**: 再検索時は目的・材料・方法を維持し、重点指示のみ追加/変更
- **Should**: 重点指示の履歴表示（直近3件）
- **Could**: 重点指示のプリセット機能

### FR-114: コピー機能強化

#### FR-114.1: ビューワー画面からのコピー
- **Must**: 各セクション（目的・材料・方法）に「検索条件にコピー」ボタン
- **Must**: クリップボードにコピーではなく、検索ページに遷移して即座に反映
- **Should**: 「一括コピー」ボタンで全セクションを反映

#### FR-114.2: 検索結果からのコピー
- **Must**: 各ノートカードに[目的][材料][方法][一括]の4ボタン
- **Must**: クリックで左側の検索フォームに即座に反映
- **Should**: 反映時にハイライトアニメーション

### FR-115: 評価機能改善

#### FR-115.1: CSV出力強化
- **Must**: 以下のカラムを出力:
  - 条件ID
  - Embeddingモデル
  - LLMモデル
  - プロンプト名
  - nDCG@5, nDCG@10
  - Precision@5, Precision@10
  - Recall@10
  - MRR
- **Should**: ファイル名に日時を含める

#### FR-115.2: UI改善
- **Must**: デバッグ表示を削除（本番向け）
- **Must**: 評価履歴保存件数: 5件 → 50件に拡張

---

## 非機能要件

- **パフォーマンス**: 再検索開始まで1秒以内
- **ユーザビリティ**: コピー操作後0.5秒以内にフォーム反映
- **アクセシビリティ**: キーボード操作対応

---

## 制約条件

1. **技術的制約**
   - Next.js 15 App Router環境
   - 既存のsearch/page.tsx, viewer/page.tsx, evaluate/page.tsxを改修
   - バックエンドAPI変更は不要（フロントエンドのみ）

2. **スコープ外**
   - 検索履歴の永続化（localStorageで対応済み）
   - 評価結果のグラフ表示（将来検討）

---

## 成功基準

- [ ] FR-113: 重点指示を追加して再検索が動作
- [ ] FR-114: ビューワーから検索条件にコピーが動作
- [ ] FR-114: 検索結果から検索フォームに即座反映
- [ ] FR-115: CSV出力で全指標がエクスポート可能
- [ ] FR-115: 評価履歴が50件まで保存される
- [ ] 型チェック（TypeScript）パス
- [ ] ローカル環境での手動テスト完了
