# テスト仕様書: UI/UX機能改善（Phase 4）

## 概要

**テスト対象**: FR-113（再検索機能）、FR-114（コピー機能強化）、FR-115（評価機能改善）
**作成日**: 2026-01-02
**テスト環境**: ローカル開発環境（`npm run dev`）

---

## 前提条件

- フロントエンドが起動していること（`npm run dev`）
- バックエンドが起動していること（`python server.py`）
- APIキー（OpenAI, Cohere）が設定ページで設定済みであること
- テスト用の実験ノートがChromaDBに登録済みであること

---

## FR-113: 再検索機能

### TC-113-1: 再検索ボタンの表示

**目的**: 検索実行後に「重点指示を追加して再検索」ボタンが表示されることを確認

**手順**:
1. 検索ページ（/search）を開く
2. 目的・材料・方法のいずれかに検索条件を入力
3. 「検索」ボタンをクリック
4. 検索結果が表示されることを確認

**期待結果**:
- [ ] 検索結果エリアの上部に「重点指示を追加して再検索」ボタンが表示される
- [ ] ボタンは青色の枠線付きで視認しやすい

---

### TC-113-2: 再検索モーダルの表示

**目的**: モーダルが正しく表示され、現在の検索条件が表示されることを確認

**手順**:
1. TC-113-1を実行後、「重点指示を追加して再検索」ボタンをクリック
2. モーダルの表示を確認

**期待結果**:
- [ ] モーダルが画面中央に表示される
- [ ] 「現在の検索条件」セクションに、入力した目的・材料・方法が表示される
- [ ] 「重点指示」入力エリアにカーソルが自動フォーカスされる
- [ ] 「キャンセル」「再検索」ボタンが表示される

---

### TC-113-3: 再検索の実行

**目的**: 重点指示を追加して再検索が実行されることを確認

**手順**:
1. TC-113-2を実行後、重点指示テキストエリアに条件を入力（例: 「反応温度は60度以上」）
2. 「再検索」ボタンをクリック

**期待結果**:
- [ ] モーダルが閉じる
- [ ] 検索が実行される（ローディング表示）
- [ ] 左側のフォームの「重点指示」欄に入力した内容が反映されている
- [ ] 新しい検索結果が表示される

---

### TC-113-4: キャンセル動作

**目的**: キャンセルボタンでモーダルが閉じ、状態が維持されることを確認

**手順**:
1. TC-113-2を実行後、重点指示に何か入力
2. 「キャンセル」ボタンをクリック

**期待結果**:
- [ ] モーダルが閉じる
- [ ] 検索結果は変わらない
- [ ] 左側フォームの「重点指示」欄は変更されない

---

## FR-114: コピー機能強化

### TC-114-1: ビューワーからの検索条件コピー（個別）

**目的**: ビューワーの各セクションから検索ページへコピーできることを確認

**手順**:
1. ビューワーページ（/viewer）を開く
2. 実験ノートIDを入力して「表示」をクリック
3. 「目的・背景」セクションの「検索条件にコピー」ボタンをクリック

**期待結果**:
- [ ] 検索ページ（/search）に自動遷移する
- [ ] 検索フォームの「目的」欄に、ビューワーの目的内容が入力されている
- [ ] 「目的」欄が青色でハイライト表示される
- [ ] 3秒後にハイライトが解除される

---

### TC-114-2: ビューワーからの一括コピー

**目的**: ビューワーから目的・材料・方法を一括で検索ページへコピーできることを確認

**手順**:
1. ビューワーページで実験ノートを表示
2. ヘッダー部分の「目的・材料・方法を検索条件にコピー」ボタンをクリック

**期待結果**:
- [ ] 検索ページに自動遷移する
- [ ] 「目的」「材料」「方法」の全ての欄に内容が入力されている
- [ ] 全ての欄がハイライト表示される

---

### TC-114-3: クリップボードコピー

**目的**: 各セクションをクリップボードにコピーできることを確認

**手順**:
1. ビューワーページで実験ノートを表示
2. いずれかのセクションのクリップボードボタン（📋）をクリック

**期待結果**:
- [ ] 「〇〇をクリップボードにコピーしました」のメッセージが表示される
- [ ] 実際にクリップボードにコピーされている（テキストエディタ等に貼り付けて確認）
- [ ] 3秒後にメッセージが消える

---

### TC-114-4: 検索結果からのフォーム反映（個別）

**目的**: 検索結果のノートカードから目的をフォームにコピーできることを確認

**手順**:
1. 検索ページで検索を実行
2. 検索結果のノートカードにある「目的」ボタンをクリック

**期待結果**:
- [ ] 左側フォームの「目的」欄にノートの目的が入力される
- [ ] 「目的」欄がハイライト表示される
- [ ] 「目的を検索条件に反映しました」のメッセージが表示される

---

### TC-114-5: 検索結果からの一括反映

**目的**: 検索結果から目的・材料・方法を一括でフォームに反映できることを確認

**手順**:
1. 検索ページで検索を実行
2. 検索結果のノートカードにある「一括」ボタンをクリック

**期待結果**:
- [ ] 「目的」「材料」「方法」の全ての欄に内容が入力される
- [ ] 全ての欄がハイライト表示される
- [ ] 「全項目を検索条件に反映しました」のメッセージが表示される

---

### TC-114-6: URLパラメータによる初期値設定

**目的**: URLパラメータで検索条件を渡せることを確認

**手順**:
1. ブラウザで以下のURLを直接開く:
   `/search?purpose=テスト目的&materials=テスト材料&methods=テスト方法`

**期待結果**:
- [ ] 「目的」欄に「テスト目的」が入力されている
- [ ] 「材料」欄に「テスト材料」が入力されている
- [ ] 「方法」欄に「テスト方法」が入力されている
- [ ] 各欄がハイライト表示される

---

## FR-115: 評価機能改善

### TC-115-1: CSV出力ボタンの表示

**目的**: 評価履歴がある場合にCSV出力ボタンが機能することを確認

**手順**:
1. 評価ページ（/evaluate）を開く
2. 評価履歴が存在することを確認（なければ評価を実行）
3. 「CSV出力」ボタンの状態を確認

**期待結果**:
- [ ] 「CSV出力」ボタンが有効（クリック可能）
- [ ] 評価履歴がない場合はボタンが無効化されている

---

### TC-115-2: CSV出力の実行

**目的**: CSVファイルが正しくダウンロードされることを確認

**手順**:
1. 評価ページで「CSV出力」ボタンをクリック
2. ダウンロードされたファイルを確認

**期待結果**:
- [ ] `evaluation_YYYY-MM-DD.csv`形式のファイルがダウンロードされる
- [ ] Excelで開いても文字化けしない
- [ ] 以下のカラムが含まれている:
  - 条件ID
  - Embeddingモデル
  - LLMモデル
  - プロンプト名
  - nDCG@10
  - Precision@10
  - Recall@10
  - MRR
  - 実行日時

---

### TC-115-3: 履歴50件対応

**目的**: 評価履歴が50件まで保存されることを確認

**手順**:
1. 評価ページの「評価履歴」セクションを確認
2. セクションタイトルを確認

**期待結果**:
- [ ] セクションタイトルが「評価履歴（最新50件）」となっている

---

### TC-115-4: デバッグ表示の削除確認

**目的**: 開発用のデバッグ表示が削除されていることを確認

**手順**:
1. 評価ページで評価を実行
2. 評価履歴の詳細を展開（▼ボタンをクリック）
3. 表示内容を確認

**期待結果**:
- [ ] 「デバッグ情報」というセクションが表示されない
- [ ] 「履歴ID」「results配列」などのデバッグ情報が表示されない

---

## テスト結果サマリー

| テストケース | 結果 | 備考 |
|-------------|------|------|
| TC-113-1 | □ Pass / □ Fail | |
| TC-113-2 | □ Pass / □ Fail | |
| TC-113-3 | □ Pass / □ Fail | |
| TC-113-4 | □ Pass / □ Fail | |
| TC-114-1 | □ Pass / □ Fail | |
| TC-114-2 | □ Pass / □ Fail | |
| TC-114-3 | □ Pass / □ Fail | |
| TC-114-4 | □ Pass / □ Fail | |
| TC-114-5 | □ Pass / □ Fail | |
| TC-114-6 | □ Pass / □ Fail | |
| TC-115-1 | □ Pass / □ Fail | |
| TC-115-2 | □ Pass / □ Fail | |
| TC-115-3 | □ Pass / □ Fail | |
| TC-115-4 | □ Pass / □ Fail | |

**テスト実施日**:
**テスト実施者**:
**総合判定**: □ Pass / □ Fail

---

## 備考

- 検索機能のテストには有効なAPIキーが必要
- ビューワーのテストには取り込み済みの実験ノートが必要
- CSV出力はExcel（日本語版）での確認を推奨
