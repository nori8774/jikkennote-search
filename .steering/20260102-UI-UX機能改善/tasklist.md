# タスクリスト: UI/UX機能改善（Phase 4）

## 概要

**機能名**: UI/UX機能改善
**作成日**: 2026-01-02
**関連要件**: FR-113（再検索機能）、FR-114（コピー機能強化）、FR-115（評価機能改善）

---

## タスク一覧

### FR-113: 再検索機能

- [x] search/page.tsxに再検索モーダルの状態管理を追加
- [x] 「重点指示を追加して再検索」ボタンを検索結果エリアに追加
- [x] 再検索モーダルUIを実装
- [x] 再検索実行ロジックを実装

### FR-114: コピー機能強化

#### ビューワー画面

- [x] viewer/page.tsxにセクション抽出ヘルパー関数を追加
- [x] 各セクションに「検索条件にコピー」ボタンを追加
- [x] 「一括コピー」ボタンを追加
- [x] 検索ページへのルーター遷移を実装

#### 検索画面

- [x] search/page.tsxにURLパラメータからの初期値設定を追加
- [x] ノートカードに[目的][材料][方法][一括]ボタンを追加
- [x] フォーム即座反映ロジックを実装
- [x] 反映時のハイライトアニメーション追加（オプション）

### FR-115: 評価機能改善

- [x] evaluate/page.tsxにCSV出力関数を実装
- [x] CSVエクスポートボタンを追加
- [x] デバッグ表示を削除
- [x] 評価履歴上限を50件に変更（evaluate/page.tsx内で直接変更）

### テスト・検証

- [x] 型チェック（npx tsc --noEmit）パス
- [x] 実装検証（implementation-validator）パス（スコア: 4.4/5）

### ドキュメント

- [x] テスト仕様書作成

---

## 進捗メモ

- FR-114のセクション抽出: ビューワーはバックエンドからsectionsデータを取得する形式のため、ヘルパー関数追加は不要だった
- search/page.tsxのuseSearchParams: Next.js 15でSuspenseでラップが必要になった
- 履歴上限変更: lib/storage.tsではなくevaluate/page.tsx内で直接変更

---

## 振り返り

**実装完了日**: 2026-01-02
**計画と実績の差分**:
- lib/storage.tsの変更ではなく、evaluate/page.tsx内での直接変更に修正
- Next.js 15でのuseSearchParams対応（Suspenseラップ）が必要だった

**学んだこと**:
- Next.js 15ではuseSearchParamsはSuspenseでラップが必須
- BOM付きUTF-8でCSV出力すればExcelで文字化けしない

**次回への改善提案**:
- セクション抽出ロジックをlib/noteUtils.tsに共通化
- ハイライト機能をカスタムフックとして抽出
