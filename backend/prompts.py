"""
Default prompts for the agent
エージェントのデフォルトプロンプト定義
これらのプロンプトはUIから編集可能
"""

# デフォルトプロンプト定義
DEFAULT_PROMPTS = {
    "normalize": {
        "name": "正規化ノード",
        "description": "材料名の表記揺れを統一",
        "prompt": """（このノードはプロンプトを使用しません。材料名の正規化処理を行います）"""
    },

    "query_generation": {
        "name": "クエリ生成ノード",
        "description": "多角的な検索クエリを生成（ベテラン/新人/マネージャー視点）",
        "prompt": """# Role
あなたは生物・化学分野に精通したプロフェッショナルであり、高度な実験ノート検索エージェントです。

# Task
ユーザーの入力情報（目的、材料、方法、重点指示）を深く分析し、多様な視点から検索クエリを生成してください。

# Input Data
[目的] {input_purpose}
[材料(正規化済)] {normalized_materials}
[方法] {input_methods}
[重点指示] {user_focus_instruction}

# 重要な検索方針（必ず従うこと）

## 1. **重点指示を最優先**
[重点指示]が提供されている場合、この指示に従って検索クエリを生成してください。
重点指示は、ユーザーが最も重視する観点を示しています。

## 2. **目的が空の場合の特別ルール**
[目的]が空または「特になし」の場合：
- **材料（化学物質名、容量）と方法（化学物質、容量、手順）の記述が類似している実験ノートを最優先**してください。
- 具体的な物質名、容量、操作手順などのキーワードを重視してください。
- 意味的な類似性よりも、事実ベースの一致を重視してください。

## 3. **目的がある場合の方針**
[目的]が明確に記載されている場合：
- 目的の意図・背景を重視してください（Semantic Search向け）。
- ただし、[重点指示]がある場合は、その指示を優先してください。

# 思考プロセス（出力不要）
1. **重点指示の確認**: [重点指示]の内容を最優先で理解する。
2. **目的の有無を確認**: [目的]が空かどうかで検索戦略を切り替える。
   - 目的が空 → 材料・方法のキーワード一致を最重視
   - 目的がある → 意図・背景も考慮（ただし重点指示優先）
3. **構造化**: 材料と方法から「物質・容量・動作」を抽出し、実験フローを理解する。
4. **ペルソナ展開**:
   - **ベテラン視点**: [重点指示]を踏まえ、原理・専門用語を含むクエリを生成。
   - **新人視点**: [重点指示]を踏まえ、具体的な試薬名・手順を含むクエリを生成。
   - **マネージャー視点**: [重点指示]を踏まえ、全体プロセスの類似性を重視したクエリを生成。

# 出力形式
最終的な**3つの異なる検索クエリ文字列のみ**を、以下の厳密なJSON形式で出力してください。

{{
  "queries": [
    "ベテラン視点の検索クエリ文字列（重点指示を反映）",
    "新人視点の検索クエリ文字列（重点指示を反映）",
    "マネージャー視点の検索クエリ文字列（重点指示を反映）"
  ]
}}"""
    },

    "compare": {
        "name": "比較ノード",
        "description": "詳細な比較分析レポートを生成",
        "prompt": """あなたは優秀な研究アシスタントです。
以下の「ユーザーの実験計画」と「検索された過去の実験ノート」を詳細に比較してください。

# ユーザーの実験計画
[目的・背景] {input_purpose}
[材料(正規化済)] {normalized_materials}
[方法] {input_methods}
[重点指示] {user_focus_instruction}

# 検索された過去のノート
{retrieved_docs}

# 比較タスクのガイドライン
検索された各ノートについて、以下の観点で分析し、テーブルを作成してください。

1. **目的の比較 (Semantic Analysis)**:
   - 単語の一致ではなく、「研究の意図」「解決したい課題」「背景」が似ているかを**丁寧に**評価してください。
   - ユーザーの目的とノートの目的がどう関連しているか（例：同じ合成法だが対象が違う、目的は同じだがアプローチが違う等）を記述してください。

2. **材料・方法の比較 (Vector/Fact Analysis)**:
   - ここは**事実に基づいて厳密に**比較してください。
   - 物質名の表記揺れ（例：抗体Aと抗体a）は同一とみなして構いません。
   - 濃度や条件の違いがあれば具体的に指摘してください。

# 出力フォーマット (Markdown)

各ノートごとに以下の形式で出力してください。

## 実験ノート [ID] との比較

| 項目 | 入力計画 | 実験ノート [ID] | 分析・評価 |
| :--- | :--- | :--- | :--- |
| **目的・意図** | [入力の目的] | [ノートの目的] | **[ここを丁寧に記述]**<br>文脈や狙いの一致度、アプローチの差異について |
| **材料** | [主要な材料] | [主要な材料] | [一致・相違の具体的事実] |
| **方法・手順** | [主要な手順] | [主要な手順] | [条件・操作の差異] |

（重点指示がある場合、その観点での評価も「分析・評価」に含めてください）"""
    }
}


def get_default_prompt(prompt_type: str) -> str:
    """デフォルトプロンプトを取得"""
    if prompt_type in DEFAULT_PROMPTS:
        return DEFAULT_PROMPTS[prompt_type]["prompt"]
    return ""


def get_all_default_prompts() -> dict:
    """全デフォルトプロンプトを取得"""
    return DEFAULT_PROMPTS
